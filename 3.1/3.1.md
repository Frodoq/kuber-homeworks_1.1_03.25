# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.

# Решение:

### 1. Упаковка приложения в чарт для деплоя в разные окружения
**Статус: ✅ ВЫПОЛНЕНО**  
В предыдущей работе созданы:
- Шаблоны deployment и service в папке `myapp/templates/`
- Параметризованные манифесты с возможностью изменения версий
- Скрипты для деплоя в разные неймспейсы

### 2. База данных (отказоустойчивая)
- Потребление: 4 ГБ ОЗУ, 1 ядро на копию
- Количество копий: 3
- **Расчет ресурсов:**
  - CPU: 1 ядро × 3 = 3 ядра
  - ОЗУ: 4 ГБ × 3 = 12 ГБ
- **Требования к распределению:** Реплики должны быть распределены по разным нодам

### 3. Кеш (отказоустойчивый)
- Потребление: 4 ГБ ОЗУ, 1 ядро на копию
- Количество копий: 3
- **Расчет ресурсов:**
  - CPU: 1 ядро × 3 = 3 ядра
  - ОЗУ: 4 ГБ × 3 = 12 ГБ
- **Требования к распределению:** Реплики должны быть распределены по разным нодам

### 4. Фронтенд
- Потребление: 50 МБ ОЗУ, 0.2 ядра на экземпляр
- Количество копий: 5
- **Расчет ресурсов:**
  - CPU: 0.2 ядра × 5 = 1 ядро
  - ОЗУ: 0.05 ГБ × 5 = 0.25 ГБ

### 5. Бекенд
- Потребление: 600 МБ ОЗУ, 1 ядро на копию
- Количество копий: 10
- **Расчет ресурсов:**
  - CPU: 1 ядро × 10 = 10 ядер
  - ОЗУ: 0.6 ГБ × 10 = 6 ГБ

## Сводный расчет ресурсов приложения

### Базовые требования:
- **CPU:** 3 (БД) + 3 (Кеш) + 1 (Фронтенд) + 10 (Бекенд) = 17 ядер
- **ОЗУ:** 12 ГБ (БД) + 12 ГБ (Кеш) + 0.25 ГБ (Фронтенд) + 6 ГБ (Бекенд) = 30.25 ГБ

## Расчет с учетом отказоустойчивости

### Запас на выход ноды из строя:
- Применяем коэффициент 1.3 (30% запаса)
- **CPU с запасом:** 17 × 1.3 = 22.1 ядра
- **ОЗУ с запасом:** 30.25 × 1.3 = 39.33 ГБ

### Служебные ресурсы на ноду:
- kubelet, kube-proxy, container runtime: 0.5 ядра, 1 ГБ ОЗУ

## Расчет количества и параметров нод

### Вариант A: Средние ноды (8 CPU, 32 ГБ ОЗУ)
- Доступно на ноду: 7.5 CPU, 31 ГБ ОЗУ
- Минимальное количество по CPU: 22.1 ÷ 7.5 = 2.95 → 3 ноды
- Минимальное количество по ОЗУ: 39.33 ÷ 31 = 1.27 → 2 ноды
- **Проверка отказоустойчивости:** При выходе 1 ноды из 3: 22.1 ÷ 2 = 11.05 CPU на ноду > 7.5 ❌
- **Требуется:** 4 ноды (22.1 ÷ 3 = 7.37 CPU на ноду < 7.5 ✓)

### Вариант B: Крупные ноды (16 CPU, 64 ГБ ОЗУ)
- Доступно на ноду: 15.5 CPU, 63 ГБ ОЗУ
- Минимальное количество: 2 ноды
- **Проверка отказоустойчивости:** При выходе 1 ноды: 22.1 ÷ 1 = 22.1 CPU на ноду > 15.5 ❌
- **Требуется:** 3 ноды (22.1 ÷ 2 = 11.05 CPU на ноду < 15.5 ✓)

## Итоговые рекомендации

### Рекомендуемая конфигурация:
- **Количество нод:** 4
- **Параметры ноды:** 8 CPU, 32 ГБ ОЗУ
- **Общие ресурсы кластера:** 32 CPU, 128 ГБ ОЗУ

### Обоснование выбора:
1. **Распределение реплик:** 4 ноды позволяют равномерно распределить 3 реплики БД и Кеша
2. **Отказоустойчивость:** Система продолжает работать при выходе одной ноды
3. **Гибкость:** Легче масштабировать и управлять
4. **Эффективность:** Лучшее использование ресурсов

### Распределение нагрузки на 4 нодах:
- **Нода 1:** 1 БД + 1 Кеш + 3 Бекенд + 1 Фронтенд = 5.2 CPU, 9.85 ГБ
- **Нода 2:** 1 БД + 1 Кеш + 3 Бекенд + 2 Фронтенд = 5.4 CPU, 9.9 ГБ  
- **Нода 3:** 1 БД + 1 Кеш + 2 Бекенд + 1 Фронтенд = 4.2 CPU, 9.25 ГБ
- **Нода 4:** 2 Бекенд + 1 Фронтенд = 2.2 CPU, 1.25 ГБ
